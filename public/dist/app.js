angular.module("userApp",["ngAnimate","app.routes","authService","mainCtrl","userCtrl","chimeCtrl","interestedUserCtrl","userService","chimeService","interestedUserService","ui.bootstrap"]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),angular.module("app.routes",["ngRoute"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"app/views/pages/home.html",controller:"mainController",controllerAs:"main"}).when("/login",{templateUrl:"app/views/pages/login.html",controller:"mainController",controllerAs:"login"}).when("/users",{templateUrl:"app/views/pages/users/all.html",controller:"userController",controllerAs:"user"}).when("/users/create",{templateUrl:"app/views/pages/users/single.html",controller:"userCreateController",controllerAs:"user"}).when("/users/:user_id",{templateUrl:"app/views/pages/users/single.html",controller:"userEditController",controllerAs:"user"}).when("/chimes",{templateUrl:"app/views/pages/chimes/all.html",controller:"chimeController",controllerAs:"chime"}).when("/chimes/create",{templateUrl:"app/views/pages/chimes/single.html",controller:"chimeCreateController",controllerAs:"chime"}).when("/chimes/:chime_id",{templateUrl:"app/views/pages/chimes/single.html",controller:"chimeEditController",controllerAs:"chime"}).when("/interested_users",{templateUrl:"app/views/pages/interested_users/all.html",controller:"interestedUserController",controllerAs:"interestedUser"}).when("/interested_users/create",{templateUrl:"app/views/pages/interested_users/single.html",controller:"interestedUserCreateController",controllerAs:"interestedUser"}).when("/interested_users/:interested_user_id",{templateUrl:"app/views/pages/interested_users/single.html",controller:"interestedUserEditController",controllerAs:"interestedUser"}),t.html5Mode(!0)}]),angular.module("chimeCtrl",["chimeService","soundCloudService"]).controller("chimeController",["Chime",function(e){var t=this;t.processing=!0,e.all().success(function(e){t.processing=!1,t.chimes=e}),t.deleteChime=function(n){t.processing=!0,e["delete"](n).success(function(n){e.all().success(function(e){t.processing=!1,t.chimes=e})})}}]).controller("chimeCreateController",["Chime","SoundCloud","$scope","$sce","$q",function(e,t,n,r,s){var o=this;o.type="create",o.musicProviders=[{name:"SoundCloud",icon:"fa-soundcloud",value:"soundCloud"},{name:"Spotify",icon:"fa-spotify",value:"spotify"},{name:"Google Play",icon:"fa-play",value:"googlePlay"},{name:"Apple Music",icon:"fa-apple",value:"appleMusic"},{name:"YouTube",icon:"fa-youtube-play",value:"youTube"}],o.currentMusicProvider=o.musicProviders[0],n.filterByName=function(e){return function(t){return t.name!=e}},o.setMusicProvider=function(e){o.currentMusicProvider=e},o.lockStartTime=function(){console.log("locking startTime"),o.startTimeLocked=!0;var e=+o.startTime,t=o.selectedTrack.duration,n=angular.element(document.getElementById("slider-container"))[0].clientWidth;o.leftOffset=e/t*n,o.widthOffset=n-o.leftOffset},o.adjustStartTime=function(e){o.startTimeLocked||-1===e||(console.log(o.startTime),console.log("setting startTime to: ",e),o.startTime=e,n.$apply())},o.setEndTime=function(){o.widget.pause(),o.widget.getPosition(function(e){o.endTime=e,n.$apply()})},o.lockEndTime=function(){o.endTimeLocked=!0;var e=+o.startTime,t=+o.endTime,n=o.selectedTrack.duration,r=angular.element(document.getElementById("slider-container"))[0].clientWidth;o.chimeWidth=(t-e)*r/n,o.widget.bind("playProgress",function(e){e.currentPosition>=o.endTime&&o.widget.pause()})},o.clearEndTime=function(){o.widget.unbind("playProgress"),o.endTimeLocked=!1,o.endTime=o.startTime,o.chimeWidth=0},o.clearStartTime=function(){o.startTimeLocked=!1,o.endTimeLocked=!1,o.startTime=0,o.endTime=0},o.playTrack=function(e){var i=s.defer();return t.playTrack(e.permalink_url).then(function(s){console.log("oEmbed response: ",s),o.streamingTrack=e,o.soundCloudWidget=r.trustAsHtml(s.html),n.$apply(),o.iframe=document.getElementById("soundcloud_widget").querySelector("iframe"),o.widget=t.getSC().Widget(o.iframe),i.resolve()}),i.promise},o.selectTrack=function(e){o.selectedTrack=e,e!==o.streamingTrack?o.playTrack(e).then(function(){o.widget.bind("seek",function(e){console.log("Seeking...."),console.log(e),o.adjustStartTime(e.currentPosition)}),o.widget.bind("play",function(){console.log("playing..."),o.showEndTimeSetter=!0,n.$apply()}),o.widget.bind("pause",function(){console.log("paused..."),o.showEndTimeSetter=!1,n.$apply()})}):(o.widget.bind("seek",function(e){console.log("Seeking...."),console.log(e),o.adjustStartTime(e.currentPosition)}),o.widget.bind("play",function(){console.log("playing..."),o.showEndTimeSetter=!0,n.$apply()}),o.widget.bind("pause",function(){console.log("paused..."),o.showEndTimeSetter=!1,n.$apply()}))},o.clearSelectedTrack=function(){delete o.selectedTrack},o.playTrackSection=function(){console.log("playTrackSection..."),console.log(o.startTime),console.log(o.endTime),console.log(o.selectedTrack),o.widget.seekTo(o.startTime),o.widget.isPaused(function(e){e&&o.widget.play()})},o.saveChime=function(){o.processing=!0,o.message="",e.create(o.chimeData).success(function(e){o.processing=!1,o.chimeData={},o.message=e.message})}}]).controller("chimeEditController",["$routeParams","Chime",function(e,t){var n=this;n.type="update",t.get(e.chime_id).success(function(e){n.chimeData=e}),n.saveChime=function(){n.processing=!0,n.message="",t.update(e.chime_id,n.chimeData).success(function(e){n.processing=!1,n.chimeData={},n.message=e.message})}}]).directive("soundCloudSongSearch",["SoundCloud","$sce",function(e,t){return{restrict:"E",scope:{chime:"="},templateUrl:"app/views/pages/chimes/soundCloudSongSearch.html",link:function(t,n,r){t.soundCloud={},t.soundCloudSearchInput="",t.searchTracks=function(n){e.searchTracks(n).then(function(e){console.log("Search results: ",e),t.soundCloud.tracks=e,t.$apply()},function(e){console.log("No tracks found matching that search term: ",e)})},t.authenticateSoundCloud=function(){e.authenticate()}}}}]).directive("spotifySongSearch",["$sce",function(e){return{restrict:"E",scope:{chime:"="},templateUrl:"app/views/pages/chimes/spotifySongSearch.html",link:function(e,t,n){e.spotify={},e.spotifySearchInput=""}}}]),angular.module("interestedUserCtrl",["interestedUserService"]).controller("interestedUserController",["InterestedUser",function(e){var t=this;t.processing=!0,e.all().success(function(e){t.processing=!1,t.interestedUsers=e}),t.deleteInterestedUser=function(n){t.processing=!0,e["delete"](n).success(function(n){e.all().success(function(e){t.processing=!1,t.interestedUsers=e})})}}]).controller("interestedUserCreateController",["InterestedUser",function(e){var t=this;t.type="create",t.saveInterestedUser=function(){t.processing=!0,t.message="",e.create(t.interestedUserData).success(function(e){t.processing=!1,t.interestedUserData={},t.message=e.message})}}]).controller("interestedUserEditController",["$routeParams","InterestedUser",function(e,t){var n=this;n.type="update",t.get(e.interested_user_id).success(function(e){n.interestedUserData=e}),n.saveInterestedUser=function(){n.processing=!0,n.message="",t.update(e.interested_user_id,n.interestedUserData).success(function(e){n.processing=!1,n.interestedUserData={},n.message=e.message})}}]),angular.module("mainCtrl",[]).controller("mainController",["$rootScope","$location","Auth","InterestedUser",function(e,t,n,r){var s=this;s.loggedIn=n.isLoggedIn(),e.$on("$routeChangeStart",function(){s.loggedIn=n.isLoggedIn(),n.getUser().then(function(e){s.user=e.data})}),s.doLogin=function(){s.processing=!0,s.error="",n.login(s.loginData.username,s.loginData.password).success(function(e){s.processing=!1,e.success?t.path("/users"):s.error=e.message})},s.doLogout=function(){n.logout(),s.user="",t.path("/login")},s.doSignUp=function(){return console.log("signing up..."),console.log(s.interestedUser),console.log(s.interestedUser.name),r.create(s.interestedUser).success(function(e){console.log("here"),console.log(e),s.interestedUser={}}),s.hideSignUp=!0,!0}}]),angular.module("userCtrl",["userService"]).controller("userController",["User",function(e){var t=this;t.processing=!0,e.all().success(function(e){t.processing=!1,t.users=e}),t.deleteUser=function(n){t.processing=!0,e["delete"](n).success(function(n){e.all().success(function(e){t.processing=!1,t.users=e})})}}]).controller("userCreateController",["User",function(e){var t=this;t.type="create",t.saveUser=function(){t.processing=!0,t.message="",e.create(t.userData).success(function(e){t.processing=!1,t.userData={},t.message=e.message})}}]).controller("userEditController",["$routeParams","User",function(e,t){var n=this;n.type="edit",t.get(e.user_id).success(function(e){n.userData=e}),n.saveUser=function(){n.processing=!0,n.message="",t.update(e.user_id,n.userData).success(function(e){n.processing=!1,n.userData={},n.message=e.message})}}]),angular.module("authService",[]).factory("Auth",["$http","$q","AuthToken",function(e,t,n){var r={};return r.login=function(t,r){return e.post("/api/authenticate",{username:t,password:r}).success(function(e){return n.setToken(e.token),e})},r.logout=function(){n.setToken()},r.isLoggedIn=function(){return n.getToken()?!0:!1},r.getUser=function(){return n.getToken()?e.get("/api/me",{cache:!0}):t.reject({message:"User has no token."})},r}]).factory("AuthToken",["$window",function(e){var t={};return t.getToken=function(){return e.localStorage.getItem("token")},t.setToken=function(t){t?e.localStorage.setItem("token",t):e.localStorage.removeItem("token")},t}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(e,t,n){var r={};return r.request=function(e){var t=n.getToken();return t&&(e.headers["x-access-token"]=t),e},r.responseError=function(r){return 403==r.status&&(n.setToken(),t.path("/login")),e.reject(r)},r}]),angular.module("chimeService",[]).factory("Chime",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/chimes/"+t)},t.all=function(){return e.get("/api/chimes/")},t.create=function(t){return e.post("/api/chimes/",t)},t.update=function(t,n){return e.put("/api/chimes/"+t,n)},t["delete"]=function(t){return e["delete"]("/api/chimes/"+t)},t}]),angular.module("interestedUserService",[]).factory("InterestedUser",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/interested_users/"+t)},t.all=function(){return e.get("/api/interested_users/")},t.create=function(t){return e.post("/public/interested_users/",t)},t.update=function(t,n){return e.put("/api/interested_users/"+t,n)},t["delete"]=function(t){return e["delete"]("/api/interested_users/"+t)},t}]),angular.module("soundCloudService",[]).factory("SoundCloud",["$location",function(e){var t="09552849399f3a58cd8b85d8c5b1218d",n=e.protocol()+"://"+e.host()+":"+e.port(),r={};return SC.initialize({client_id:t,redirect_uri:n+"/callback"}),r.getSC=function(){return SC},r.getTrack=function(e){return SC.get("/tracks/"+e)},r.searchTracks=function(e){return SC.get("/tracks",{q:e})},r.playTrack=function(e){var t=SC.oEmbed(e,{auto_play:!0,maxheight:"70px",show_comments:!1,color:"00ECF2"});return t},r.playTrackSection=function(e,t){var n=t.toString()+"s";return SC.oEmbed(e,{t:n,auto_play:!0,maxheight:"70px",show_comments:!1,color:"00ECF2"})},r.authenticate=function(){return SC.connect(function(){SC.get("/me",function(e){alert("Hello, "+e.username)})})},r}]),angular.module("userService",[]).factory("User",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/users/"+t)},t.all=function(){return e.get("/api/users/")},t.create=function(t){return e.post("/api/users/",t)},t.update=function(t,n){return e.put("/api/users/"+t,n)},t["delete"]=function(t){return e["delete"]("/api/users/"+t)},t}]);